import{g as u,s as T,o as l,c as a,a as t,t as o,j as w,F as b,m as V,y as R,O as D,r as U,b as $,w as F,B}from"./index-rRgU2xyF.js";import{_ as I}from"./loading-a3rePalS.js";import{a as P}from"./axios-G2rPRu76.js";import{u as N}from"./toastMessage-kKI3NqS4.js";import{u as j,_ as q}from"./DelModal-N-93PpOI.js";import{_ as z}from"./PaginationComponent-Uqd3tCdg.js";const H={class:"modal-dialog modal-xl",role:"document"},G={class:"modal-content border-0"},J=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),K={class:"modal-body"},Q={class:"row"},W={class:"col-md-4"},X=t("h3",null,"用戶資料",-1),Y={class:"table"},Z={key:0},tt=t("th",{style:{width:"100px"}},"姓名",-1),et=t("th",null,"Email",-1),st=t("th",null,"電話",-1),lt=t("th",null,"地址",-1),at={class:"col-md-8"},ot=t("h3",null,"訂單細節",-1),nt={class:"table"},dt=t("th",{style:{width:"100px"}},"訂單編號",-1),it=t("th",null,"下單時間",-1),ut=t("th",null,"付款時間",-1),ct={key:0},rt={key:1},_t=t("th",null,"付款狀態",-1),ht={key:0,class:"text-success"},pt={key:1,class:"text-muted"},vt=t("th",null,"總金額",-1),mt=t("h3",null,"選購商品",-1),ft={class:"table"},bt=t("thead",null,[t("tr")],-1),yt={class:"text-end"},gt={class:"d-flex justify-content-end"},$t={class:"form-check"},kt={class:"form-check-label",for:"flexCheckDefault"},xt={key:0},Mt={key:1},Ct={class:"modal-footer"},Pt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),wt={__name:"OrderModal",props:{order:Object},emits:["update-paid"],setup(E,{expose:k,emit:_}){const{openModal:v,hideModal:m,modalRef:f}=j(),x=E,y=_,e=u({});return T(()=>x.order,n=>{e.value=n}),k({openModal:v,hideModal:m}),(n,h)=>(l(),a("div",{class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalRef",ref:f},[t("div",H,[t("div",G,[J,t("div",K,[t("div",Q,[t("div",W,[X,t("table",Y,[e.value.user?(l(),a("tbody",Z,[t("tr",null,[tt,t("td",null,o(e.value.user.name),1)]),t("tr",null,[et,t("td",null,o(e.value.user.email),1)]),t("tr",null,[st,t("td",null,o(e.value.user.tel),1)]),t("tr",null,[lt,t("td",null,o(e.value.user.address),1)])])):w("",!0)])]),t("div",at,[ot,t("table",nt,[t("tbody",null,[t("tr",null,[dt,t("td",null,o(e.value.id),1)]),t("tr",null,[it,t("td",null,o(n.$filters.date(e.value.create_at)),1)]),t("tr",null,[ut,t("td",null,[e.value.paid_date?(l(),a("span",ct,o(n.$filters.date(e.value.paid_date)),1)):(l(),a("span",rt,"時間不正確"))])]),t("tr",null,[_t,t("td",null,[e.value.is_paid?(l(),a("strong",ht,"已付款")):(l(),a("span",pt,"尚未付款"))])]),t("tr",null,[vt,t("td",null,o(n.$filters.currency(e.value.total)),1)])])]),mt,t("table",ft,[bt,t("tbody",null,[(l(!0),a(b,null,V(e.value.products,i=>(l(),a("tr",{key:i.id},[t("th",null,o(i.product.title),1),t("td",null,o(i.qty)+" / "+o(i.product.unit),1),t("td",yt,o(n.$filters.currency(i.final_total)),1)]))),128))])]),t("div",gt,[t("div",$t,[R(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":h[0]||(h[0]=i=>e.value.is_paid=i)},null,512),[[D,e.value.is_paid]]),t("label",kt,[e.value.is_paid?(l(),a("span",xt,"已付款")):(l(),a("span",Mt,"未付款"))])])])])])]),t("div",Ct,[Pt,t("button",{type:"button",class:"btn btn-primary",onClick:h[1]||(h[1]=i=>y("update-paid",e.value))}," 修改付款狀態 ")])])])],512))}};var Vt={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"rubby-api",BASE_URL:"/cat-paws/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Et=t("img",{src:I,width:"500",alt:"loading",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},null,-1),Ot={class:"container"},Rt={class:"table mt-4"},Dt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),Lt=["textContent"],At={class:"list-unstyled"},St={class:"text-right"},Tt={class:"form-check form-switch"},Ut=["id","onUpdate:modelValue","onChange"],Ft=["for"],Bt={key:0},It={key:1},Nt={class:"btn-group"},jt=["onClick"],qt=["onClick"],Wt={__name:"AdminOrderView",setup(E){const k=N(),{pushMessage:_}=k,v=u(null),m=u(null),f=u({}),x=u(!1),y=u({}),e=u(!1),n=u({}),h=u({}),i=u(1),{VITE_APP_URL:M,VITE_APP_PATH:C}=Vt,g=(d=1)=>{const p=`${M}/api/${C}/admin/orders?page=${d}`;e.value=!0,P.get(p,h).then(r=>{f.value=r.data.orders,y.value=r.data.pagination,e.value=!1}).catch(r=>{e.value=!1,_({style:"danger",title:"錯誤訊息",content:r.response.data.message})})},L=d=>{n.value={...d},x.value=!1,v.value.openModal()},A=d=>{n.value={...d},m.value.openModal()},O=d=>{const p=`${M}/api/${C}/admin/order/${d.id}`,r={is_paid:d.is_paid};e.value=!0,P.put(p,{data:r}).then(s=>{e.value=!1,v.value.hideModal(),g(i.value),_({style:"success",title:"更新付款狀態",content:s.data.message})}).catch(s=>{e.value=!1,_({style:"danger",title:"錯誤訊息",content:s.response.data.message})})};g();const S=()=>{const d=`${M}/api/${C}/admin/order/${n.value.id}`;e.value=!0,P.delete(d).then(()=>{e.value=!1,m.value.hideModal(),g(i.value)}).catch(p=>{e.value=!1,_({style:"danger",title:"錯誤訊息",content:p.response.data.message})})};return(d,p)=>{const r=U("VueLoading");return l(),a(b,null,[$(r,{active:e.value,"is-full-page":!0,"background-color":"#FFF8F1",opacity:1,"z-index":1060},{default:F(()=>[Et]),_:1},8,["active"]),t("div",Ot,[t("table",Rt,[Dt,t("tbody",null,[(l(!0),a(b,null,V(f.value,s=>(l(),a(b,{key:s.id},[f.value.length?(l(),a("tr",{key:0,class:B({"text-secondary":!s.is_paid})},[t("td",null,o(d.$filters.date(s.create_at)),1),t("td",null,[s.user?(l(),a("span",{key:0,textContent:o(s.user.email)},null,8,Lt)):w("",!0)]),t("td",null,[t("ul",At,[(l(!0),a(b,null,V(s.products,c=>(l(),a("li",{key:c.id},o(c.product.title)+" 數量："+o(c.qty)+" "+o(c.product.unit),1))),128))])]),t("td",St,o(s.total),1),t("td",null,[t("div",Tt,[R(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${s.id}`,"onUpdate:modelValue":c=>s.is_paid=c,onChange:c=>O(s)},null,40,Ut),[[D,s.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${s.id}`},[s.is_paid?(l(),a("span",Bt,"已付款")):(l(),a("span",It,"未付款"))],8,Ft)])]),t("td",null,[t("div",Nt,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:c=>L(s)}," 檢視 ",8,jt),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:c=>A(s)}," 刪除 ",8,qt)])])],2)):w("",!0)],64))),128))])]),$(wt,{order:n.value,ref_key:"orderModalRef",ref:v,onUpdatePaid:O},null,8,["order"]),$(q,{item:n.value,ref_key:"delModalRef",ref:m,onDelItem:S},null,8,["item"]),$(z,{pages:y.value,onEmitPages:g},null,8,["pages"])])],64)}}};export{Wt as default};
