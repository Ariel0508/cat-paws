import{g as m,k as H,s as G,h as J,r as f,o as _,c as p,b as n,w as u,a as e,F as B,m as I,y as k,D as A,d as c,t as a,j as K,B as w,C as Q}from"./index-rRgU2xyF.js";import{_ as W}from"./loading-a3rePalS.js";import{a as T}from"./axios-G2rPRu76.js";import{u as X}from"./cartStore-JyZy7-1Z.js";import{u as Y}from"./toastMessage-kKI3NqS4.js";import{_ as Z}from"./ToastMessages-9cuA_cXF.js";var ee={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"rubby-api",BASE_URL:"/cat-paws/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const te=e("img",{src:W,width:"500",alt:"loading",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},null,-1),se=e("div",{class:"container mt-7 p-0"},[e("nav",{"aria-label":"breadcrumb"},[e("ol",{class:"breadcrumb"},[e("li",{class:"breadcrumb-item active","aria-current":"page"},"結帳")])])],-1),oe=e("div",{class:"container-fluid mt-6 rwdStep"},[e("div",{class:"position-relative m-4"},[e("div",{class:"progress",style:{height:"2px"}},[e("div",{class:"progress-bar",role:"progressbar",style:{width:"50%"},"aria-valuenow":"50","aria-valuemin":"0","aria-valuemax":"100"})]),e("button",{type:"button",class:"position-absolute top-0 start-0 translate-middle btn btn-sm btn-brown rounded-pill",style:{width:"2rem",height:"2rem"}}," 1 "),e("button",{type:"button",class:"position-absolute top-0 start-50 translate-middle btn btn-sm btn-brown rounded-pill",style:{width:"2rem",height:"2rem"}}," 2 "),e("button",{type:"button",class:"position-absolute top-0 start-100 translate-middle btn btn-sm btn-gray2 rounded-pill",style:{width:"2rem",height:"2rem"}}," 3 ")]),e("div",{class:"pt-1"},[e("div",{class:"position-relative m-4"},[e("div",{class:"position-absolute top-0 start-0 translate-middle text-brown",style:{width:"4rem",height:"2rem"}}," 確認商品 "),e("div",{class:"position-absolute top-0 start-50 translate-middle text-brown",style:{width:"4rem",height:"2rem"}}," 填寫資料 "),e("div",{class:"position-absolute top-0 start-100 translate-middle",style:{width:"4rem",height:"2rem"}}," 完成訂單 ")])])],-1),le={class:"container mt-5"},ae={class:"row"},ne={key:0,class:"table align-middle border-lightBrown pc"},ie=e("thead",null,[e("tr",{class:"text-center"},[e("th",{width:"200"},"商品名稱"),e("th",{width:"120"},"單價"),e("th",{width:"200",class:"text-center"},"數量"),e("th",{width:"200"},"小計")])],-1),re={class:"text-center"},de=["src"],ce={class:"border-white"},ue={colspan:"2",class:"pt-4"},me={class:"d-flex align-items-center justify-content-center"},_e=e("i",{class:"bi bi-ticket-perforated fs-2 text-brown px-3"},null,-1),pe=e("option",{value:"請輸入優惠券",selected:""},"請輸入優惠券",-1),he=e("option",{value:"newMember20%"},"新會員首購八折優惠",-1),ve=e("option",{value:"purchasesover200010%"}," 滿兩千享九折優惠 ",-1),fe=[pe,he,ve],be={class:"text-center pt-4"},ge={class:"me-5"},ye={class:"text-center pt-4"},we={class:"text-brown"},xe={class:"border-white"},$e=e("td",null,null,-1),Ve=e("td",null,null,-1),Ce={class:"fs-5 text-end py-4",colspan:"2"},ke={class:"me-8"},Te={class:"text-brown"},Ne={class:"mobile justify-content-center"},Me={class:"row"},Se={class:"col-4 p-0"},Pe=["src"],Ue={class:"col-8 p-0"},Le={class:"mt-3 d-flex justify-content-between"},Ee={class:"pe-4"},Re={class:"border-top border-lightBrown p-3 bg-white"},je={class:"d-flex align-items-center"},Be=e("i",{class:"bi bi-ticket-perforated fs-2 text-brown pe-3"},null,-1),Ie=e("option",{value:"請輸入優惠券",selected:""},"請輸入優惠券",-1),Ae=e("option",{value:"newMember20%"},"新會員首購八折優惠",-1),Fe=e("option",{value:"purchasesover200010%"},"滿兩千享九折優惠",-1),De=[Ie,Ae,Fe],qe={class:"text-black text-end mt-3"},Oe={class:"text-end mt-3"},ze={class:"text-brown"},He={class:"fs-5 text-end mt-3"},Ge={class:"text-brown"},Je={class:"row justify-content-center mt-5"},Ke=e("h5",{class:"my-5 text-center"},"購買人資料",-1),Qe={class:"row"},We={class:"col-md-6 col-12"},Xe={class:"mb-4"},Ye=e("label",{for:"name",class:"form-label"},"*姓名",-1),Ze=e("div",{class:"text-danger small mt-2"}," 姓名為必填 ",-1),et={class:"mb-4"},tt=e("label",{for:"tel",class:"form-label"},"*電話",-1),st=e("div",{class:"text-danger small mt-2"}," 需要正確的電話號碼 ",-1),ot={class:"mb-4"},lt=e("label",{for:"email",class:"form-label"},"*Email",-1),at={class:"col-md-6 col-12"},nt={class:"mb-4"},it=e("label",{for:"address",class:"form-label"},"*地址",-1),rt=e("div",{class:"text-danger small mt-2"}," 地址為必填 ",-1),dt={class:"mb-4"},ct=e("label",{for:"message",class:"form-label"},"留言",-1),ut=e("div",{class:"text-end py-5"},[e("button",{type:"submit",class:"btn p-0 border-0"},[e("div",{class:"d-flex justify-content-center text-brown"},[e("div",{class:"d-flex align-items-center justify-content-center",style:{width:"185px",height:"40px",background:"#ffffff",border:"1px solid #a2672d"}},[e("a",{class:"text-center bg-brown text-decoration-none text-white m-1 d-block",style:{width:"175px",height:"30px","line-height":"30px"}},"送出訂單 ")])])])],-1),gt={__name:"OrderView",setup(mt){const{VITE_APP_URL:x,VITE_APP_PATH:$}=ee,N=X(),{getCart:M}=N,o=m(N.carts),F=H(),h=m(!1),D=Y(),{pushMessage:b}=D,S=()=>{const l=`${x}/api/${$}/cart`;T.get(l).then(s=>{o.value=s.data.data}).catch(()=>{h.value=!1})},V=m(null),i=m({user:{name:"",email:"",tel:"",address:""},message:""}),q=()=>{if(d.value==="purchasesover200010%"&&o.value.total<2e3){b({style:"danger",title:"無法使用優惠券",content:"購物車金額需達到2000元才能使用優惠券"});return}const l=`${x}/api/${$}/order`,s=i.value;h.value=!0,T.post(l,{data:s}).then(v=>{V.value&&(V.value.resetForm(),h.value=!1),F.push(`/completed/${v.data.orderId}`),localStorage.removeItem("coupon_code")}).catch(()=>{h.value=!1})},O=l=>/^(09)[0-9]{8}$/.test(l)?!0:"需要正確的電話號碼",d=m(localStorage.getItem("coupon_code")||"請輸入優惠券"),C=m(!1),P=()=>{if(d.value==="purchasesover200010%"&&o.value.total<2e3){b({style:"danger",title:"無法使用優惠券",content:"購物車金額需達到2000元才能使用優惠券"});return}const l=`${x}/api/${$}/coupon`,s={code:d.value};C.value=!0,T.post(l,{data:s}).then(v=>{s.code==="請輸入優惠券"||b({style:"success",title:"加入優惠券",content:v.data.message}),M(),C.value=!1}).catch(()=>{C.value=!1,b({style:"danger",title:"優惠券不可用"})}),localStorage.setItem("coupon_code",d.value)};return G(()=>o.value,()=>{S()}),J(()=>{M(),S()}),(l,s)=>{var L,E,R,j;const v=f("VueLoading"),U=f("RouterLink"),g=f("v-field"),y=f("error-message"),z=f("v-form");return _(),p("div",null,[n(v,{active:h.value,"is-full-page":!0,"background-color":"#FFF8F1",opacity:1,"z-index":1060},{default:u(()=>[te]),_:1},8,["active"]),se,oe,e("div",le,[e("div",ae,[o.value.total!==0?(_(),p("table",ne,[ie,e("tbody",re,[(_(!0),p(B,null,I(o.value.carts,t=>(_(),p("tr",{key:t.id},[e("td",null,[e("div",null,[e("img",{src:t.product.imageUrl,class:"img-fluid object-fit-cover",style:{width:"80px",height:"80px"},alt:""},null,8,de)]),n(U,{class:"text-decoration-none text-black",to:`/product/${t.product.id}`},{default:u(()=>[c(a(t.product.title),1)]),_:2},1032,["to"])]),e("td",null,"$"+a(l.$filters.numberToCurrencyNo(t.product.price)),1),e("td",null,a(t.qty),1),e("td",null,"$"+a(l.$filters.numberToCurrencyNo(t.total)),1)]))),128))]),e("tfoot",null,[e("tr",ce,[e("td",ue,[e("div",me,[_e,k(e("select",{name:"addCoupon",id:"addCoupon",class:"form-select rounded w-50 p-2 fs-6","onUpdate:modelValue":s[0]||(s[0]=t=>d.value=t),onChange:P},fe,544),[[A,d.value]])])]),e("td",be,[e("div",ge,[c(" 總計："),e("span",null,"$"+a(l.$filters.numberToCurrencyNo(o.value.total)),1)])]),e("td",ye,[c(" 折扣："),e("span",we,"$"+a(l.$filters.numberToCurrencyNo(Math.floor(o.value.total-o.value.final_total))),1)])]),e("tr",xe,[$e,Ve,e("td",Ce,[e("div",ke,[c(" 訂單金額("+a((E=(L=o.value)==null?void 0:L.carts)==null?void 0:E.length)+"商品)： ",1),e("span",Te,"$"+a(l.$filters.numberToCurrencyNo(Math.ceil(o.value.final_total)))+"元",1)])])])])])):K("",!0),e("div",Ne,[(_(!0),p(B,null,I(o.value.carts,t=>(_(),p("div",{class:"border-top border-lightBrown p-3 bg-white",key:t.id},[e("div",Me,[e("div",Se,[e("img",{src:t.product.imageUrl,class:"img-fluid object-fit-cover",style:{width:"80px",height:"80px"},alt:""},null,8,Pe)]),e("div",Ue,[n(U,{class:"text-decoration-none text-black",to:`/product/${t.product.id}`,style:{"font-size":"14px"}},{default:u(()=>[c(a(t.product.title),1)]),_:2},1032,["to"]),e("div",Le,[e("div",null," $"+a(l.$filters.numberToCurrencyNo(t.product.price)),1),e("div",Ee,"x "+a(t.qty),1)])])])]))),128)),e("div",Re,[e("div",je,[Be,k(e("select",{name:"addCoupon",id:"addCoupon",class:"form-select rounded w-100 p-2 fs-6","onUpdate:modelValue":s[1]||(s[1]=t=>d.value=t),onChange:P},De,544),[[A,d.value]])]),e("div",qe,[c(" 總計："),e("span",null,"$"+a(l.$filters.numberToCurrencyNo(o.value.total)),1)]),e("div",Oe,[c(" 折扣："),e("span",ze," $"+a(l.$filters.numberToCurrencyNo(Math.floor(o.value.total-o.value.final_total))),1)]),e("div",He,[c(" 訂單金額("+a((j=(R=o.value)==null?void 0:R.carts)==null?void 0:j.length)+"商品)： ",1),e("span",Ge,"$"+a(l.$filters.numberToCurrencyNo(Math.ceil(o.value.final_total)))+"元",1)])])])]),e("div",Je,[n(z,{ref_key:"formRef",ref:V,class:"form-floating",onSubmit:q},{default:u(({errors:t})=>[Ke,e("div",Qe,[e("div",We,[e("div",Xe,[Ye,n(g,{id:"name",name:"name",type:"text",class:w(["form-control",{"is-invalid":t.name}]),placeholder:"請輸入收件人姓名",rules:"required",modelValue:i.value.user.name,"onUpdate:modelValue":s[2]||(s[2]=r=>i.value.user.name=r)},null,8,["class","modelValue"]),n(y,{name:"name",class:"invalid-feedback"},{default:u(()=>[Ze]),_:1})]),e("div",et,[tt,n(g,{id:"tel",name:"tel",type:"text",class:w(["form-control",{"is-invalid":t.tel}]),placeholder:"請輸入收件人電話",rules:O,modelValue:i.value.user.tel,"onUpdate:modelValue":s[3]||(s[3]=r=>i.value.user.tel=r)},null,8,["class","modelValue"]),n(y,{name:"tel",class:"invalid-feedback"},{default:u(()=>[st]),_:1})]),e("div",ot,[lt,n(g,{id:"email",name:"email",type:"email",class:w(["form-control",{"is-invalid":t.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:i.value.user.email,"onUpdate:modelValue":s[4]||(s[4]=r=>i.value.user.email=r)},null,8,["class","modelValue"]),n(y,{name:"email",class:"invalid-feedback"})])]),e("div",at,[e("div",nt,[it,n(g,{id:"address",name:"address",type:"text",class:w(["form-control",{"is-invalid":t.address}]),placeholder:"請輸入收件人地址",rules:"required",modelValue:i.value.user.address,"onUpdate:modelValue":s[5]||(s[5]=r=>i.value.user.address=r)},null,8,["class","modelValue"]),n(y,{name:"address",class:"invalid-feedback"},{default:u(()=>[rt]),_:1})]),e("div",dt,[ct,k(e("textarea",{name:"",id:"message",class:"form-control",cols:"20",rows:"5","onUpdate:modelValue":s[6]||(s[6]=r=>i.value.message=r)},null,512),[[Q,i.value.message]])])])]),ut]),_:1},512)])]),n(Z)])}}};export{gt as default};
